<html lang="en">
  <head>

  </head>
  <body>
    <video autoplay></video>
  </body>
  <script src="simplepeer.min.js"></script>
  <script src="media-recorder-stream.js"></script>
  <script src="../dist/media-source-stream.js"></script>
  <script>
    navigator.getUserMedia({
      audio: true,
      video: true,
    },function (stream) {
      
      var recordStream = mediaRecorderStream(stream, {
        mimeType: 'video/webm; codecs=vp8',
        interval: 100
      })
      
      var peer1 = new SimplePeer({
        initiator: true
      })
      var peer2 = new SimplePeer()
      peer1.on('signal', function (data) {
        peer2.signal(data)
      })
      peer2.on('signal', function (data) {
        peer1.signal(data)
      })
      
      peer1.on('connect', function () {
        recordStream.pipe(peer1)
      })
      
      var sourceStream = MediaSourceStream(peer2)
      
      var url = window.URL.createObjectURL(sourceStream.mediaSource)
      document.querySelector('video').src = url
    }, function () {})
  </script>
</html>