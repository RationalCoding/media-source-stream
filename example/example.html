<html lang="en">
  <head>
    <style>
      video {
        max-width: 200px;
      }
    
    </style>
  </head>
  <body>
    <h1>Video over data channel</h1>
    <p>Datachannel replacement for MediaConnection.</p>
    <h3>Local</h3>
    <video autoplay></video>
    <h3>Remote</h3>
    <video autoplay></video>
  </body>
  <script src="simplepeer.min.js"></script>
  <script src="media-recorder-stream.js"></script>
  <script src="../dist/media-source-stream.js"></script>
  <script>
    var videos = document.querySelectorAll('video')
    
    navigator.getUserMedia({
      audio: true,
      video: true,
    },function (stream) {
      
      videos[0].src = window.URL.createObjectURL(stream)
      
      var recordStream = mediaRecorderStream(stream, {
        mimeType: 'video/webm; codecs=vp8',
        interval: 100
      })
      
      var peer1 = new SimplePeer({
        initiator: true
      })
      var peer2 = new SimplePeer()
      peer1.on('signal', function (data) {
        peer2.signal(data)
      })
      peer2.on('signal', function (data) {
        peer1.signal(data)
      })
      
      peer1.on('connect', function () {
        recordStream.pipe(peer1)
      })
      
      var sourceStream = new MediaSourceStream()
      peer2.pipe(sourceStream)
      
      var url = window.URL.createObjectURL(sourceStream.mediaSource)
      videos[1].src = url
    }, function () {})
  </script>
</html>